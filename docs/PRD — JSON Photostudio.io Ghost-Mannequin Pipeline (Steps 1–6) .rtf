{\rtf1\ansi\ansicpg1252\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\froman\fcharset0 Times-Bold;\f1\froman\fcharset0 Times-Roman;\f2\fmodern\fcharset0 Courier;
\f3\fmodern\fcharset0 Courier-Bold;}
{\colortbl;\red255\green255\blue255;\red0\green0\blue0;\red109\green109\blue109;}
{\*\expandedcolortbl;;\cssrgb\c0\c0\c0;\cssrgb\c50196\c50196\c50196;}
{\*\listtable{\list\listtemplateid1\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid1}
{\list\listtemplateid2\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid101\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid2}
{\list\listtemplateid3\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid201\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid3}
{\list\listtemplateid4\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid301\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid4}
{\list\listtemplateid5\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid401\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid5}
{\list\listtemplateid6\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid501\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid6}
{\list\listtemplateid7\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid601\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid7}
{\list\listtemplateid8\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid701\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid8}
{\list\listtemplateid9\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid801\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listname ;}\listid9}
{\list\listtemplateid10\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid901\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid10}
{\list\listtemplateid11\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1001\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid11}
{\list\listtemplateid12\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1101\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid12}
{\list\listtemplateid13\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1201\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid13}
{\list\listtemplateid14\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1301\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid14}
{\list\listtemplateid15\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1401\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid15}
{\list\listtemplateid16\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1501\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid16}
{\list\listtemplateid17\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1601\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid17}
{\list\listtemplateid18\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1701\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid18}
{\list\listtemplateid19\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1801\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid19}
{\list\listtemplateid20\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1901\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid20}
{\list\listtemplateid21\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2001\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid21}
{\list\listtemplateid22\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2101\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid22}
{\list\listtemplateid23\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2201\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid23}
{\list\listtemplateid24\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2301\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid24}
{\list\listtemplateid25\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2401\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid25}
{\list\listtemplateid26\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2501\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid26}
{\list\listtemplateid27\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2601\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid27}
{\list\listtemplateid28\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2701\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid28}
{\list\listtemplateid29\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2801\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid29}
{\list\listtemplateid30\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2901\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid30}}
{\*\listoverridetable{\listoverride\listid1\listoverridecount0\ls1}{\listoverride\listid2\listoverridecount0\ls2}{\listoverride\listid3\listoverridecount0\ls3}{\listoverride\listid4\listoverridecount0\ls4}{\listoverride\listid5\listoverridecount0\ls5}{\listoverride\listid6\listoverridecount0\ls6}{\listoverride\listid7\listoverridecount0\ls7}{\listoverride\listid8\listoverridecount0\ls8}{\listoverride\listid9\listoverridecount0\ls9}{\listoverride\listid10\listoverridecount0\ls10}{\listoverride\listid11\listoverridecount0\ls11}{\listoverride\listid12\listoverridecount0\ls12}{\listoverride\listid13\listoverridecount0\ls13}{\listoverride\listid14\listoverridecount0\ls14}{\listoverride\listid15\listoverridecount0\ls15}{\listoverride\listid16\listoverridecount0\ls16}{\listoverride\listid17\listoverridecount0\ls17}{\listoverride\listid18\listoverridecount0\ls18}{\listoverride\listid19\listoverridecount0\ls19}{\listoverride\listid20\listoverridecount0\ls20}{\listoverride\listid21\listoverridecount0\ls21}{\listoverride\listid22\listoverridecount0\ls22}{\listoverride\listid23\listoverridecount0\ls23}{\listoverride\listid24\listoverridecount0\ls24}{\listoverride\listid25\listoverridecount0\ls25}{\listoverride\listid26\listoverridecount0\ls26}{\listoverride\listid27\listoverridecount0\ls27}{\listoverride\listid28\listoverridecount0\ls28}{\listoverride\listid29\listoverridecount0\ls29}{\listoverride\listid30\listoverridecount0\ls30}}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\sa321\partightenfactor0

\f0\b\fs48 \cf0 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 PRD \'97 Photostudio.io Ghost-Mannequin Pipeline (Steps 1\'966)\
\pard\pardeftab720\sa298\partightenfactor0

\fs36 \cf0 0) Executive Summary\
\pard\pardeftab720\sa240\partightenfactor0

\f1\b0\fs24 \cf0 A deterministic, 6-phase pipeline that turns garment images into professional, consistent ghost-mannequin renders with automated QA, packaging, and learning loops.\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Core ideas
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls1\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Analyze \uc0\u8594  Weave \u8594  Render \u8594  QA/Correct \u8594  Deliver \u8594  Learn.\
\ls1\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 JSON is the contract across phases; prompts are 
\f0\b sectioned
\f1\b0  and 
\f0\b woven
\f1\b0  from JSON (no raw JSON pasted).\
\ls1\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Color accuracy enforced (\uc0\u916 E2000), brand safety preserved, hollow effect validated.\
\ls1\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Dual rendering routes: 
\f0\b Route A
\f1\b0  (SDXL/ControlNet/IP-Adapter) and 
\f0\b Route B
\f1\b0  (Gemini / fast fallback).\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Primary KPIs
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls2\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Consistency \uc0\u8805  
\f0\b 90\'9695%
\f1\b0 \
\ls2\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Color mean \uc0\u916 E2000 \u8804  
\f0\b 2.0
\f1\b0  (p95 \uc0\u8804  4.0)\
\ls2\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Pass-rate (QA) \uc0\u8805  
\f0\b 85%
\f1\b0 \
\ls2\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Median E2E latency \uc0\u8804  
\f0\b 8s
\f1\b0  (batch mode acceptable)\
\ls2\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Brand label legibility \uc0\u8805  
\f0\b 70% OCR confidence
\f1\b0 \
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f0\b\fs36 \cf0 \strokec2 1) Scope & Non-Goals\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 In scope
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls3\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Single-item flatlay/ghost-mannequin product images.\
\ls3\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Automated image analysis, prompt generation, image rendering, QA + correction, packaging, analytics.\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Out of scope (v1)
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls4\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 On-model try-on, 3D garment reconstruction, multi-item scene composition, video outputs.\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f0\b\fs36 \cf0 \strokec2 2) High-Level Architecture\
\pard\pardeftab720\partightenfactor0

\f2\b0\fs26 \cf0 flowchart LR\
A[Input Garment Image(s)] --> B[Step 1: Preprocess & JSON]\
B --> C[Step 2: Prompt Weaver]\
C --> D\{Step 3: Render<br/>Route A SDXL / Route B Gemini\}\
D --> E[Step 4: Auto-QA + Correct + Select]\
E --> F[Step 5: Package & Publish<br/>(PNG master, WebP/AVIF variants, manifest, S3/CDN)]\
F --> G[Step 6: Feedback & Auto-Tuning<br/>(DB, dashboards, alerts)]\
G --> C\
\pard\pardeftab720\partightenfactor0

\f1\fs24 \cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f0\b\fs36 \cf0 \strokec2 3) Phases (Detailed)\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf0 Phase 1/6 \'97 Preprocess & JSON (step1_preprocess.py)\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Purpose
\f1\b0 : Produce a rich, model-agnostic JSON \'93source of truth\'94.\

\f0\b Inputs
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls5\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 RGB image (flatlay or rough mannequin), optional API key for enrichment.\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Processing
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls6\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Image quality metrics: resolution, lighting (mean/std), focus (Laplacian var), contrast.\
\ls6\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Segmentation: GrabCut + morphology + edge refinement; complexity + coverage metrics.\
\ls6\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Fabric analysis: LBP texture histogram \uc0\u8594  texture class, reflectance/drape heuristics.\
\ls6\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Color extraction: LAB + KMeans; primary & secondary colors; pattern via FFT peaks + line checks.\
\ls6\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Optional Gemini enrichment for coarse category & style fields.\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Outputs
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls7\ilvl0
\f2\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 step1/garment_analysis.json
\f1\fs24 \
\ls7\ilvl0
\f2\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 step1/mask.png
\f1\fs24 \
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Key functions
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls8\ilvl0
\f2\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 _assess_image_quality
\f1\fs24 , 
\f2\fs26 _segment_garment
\f1\fs24 , 
\f2\fs26 _analyze_fabric
\f1\fs24 , 
\f2\fs26 _extract_colors
\f1\fs24 , 
\f2\fs26 _detect_pattern
\f1\fs24 , 
\f2\fs26 _compile_output
\f1\fs24 \
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 CLI
\f1\b0 \
\pard\pardeftab720\partightenfactor0

\f2\fs26 \cf0 photostudio-preprocess --image ./inputs/tshirt.jpg --out ./step1 [--gemini-api-key ...]\
\pard\pardeftab720\partightenfactor0

\f1\fs24 \cf3 \strokec3 \
\pard\pardeftab720\sa280\partightenfactor0

\f0\b\fs28 \cf0 \strokec2 Phase 2/6 \'97 Prompt Weaver (step2_prompt_weaver.py)\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Purpose
\f1\b0 : Convert JSON to 
\f0\b sectioned
\f1\b0  natural-language prompts with guardrails.\

\f0\b Sections
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls9\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	1	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Template inheritance & verification flags\
\ls9\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	2	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Non-negotiable facts (JSON paraphrased)\
\ls9\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	3	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Mandatory style guide (white bg, high-key, 2048\'b2, sRGB, frame %)\
\ls9\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	4	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Garment-aware rules (zipper logic, hollow openings, etc.)\
\ls9\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	5	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Forbidden edits (no invented features, no label relocation)\
\ls9\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	6	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Critical quality checks (\uc0\u916 E match, resolution, hollow effect)\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Inputs
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls10\ilvl0
\f2\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 garment_analysis.json
\f1\fs24 , 
\f2\fs26 configs/style_kit.yml
\f1\fs24 \
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Outputs
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls11\ilvl0
\f2\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 step2/prompt.txt
\f1\fs24 , 
\f2\fs26 step2/prompt.meta.json
\f1\fs24 \
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 CLI
\f1\b0 \
\pard\pardeftab720\partightenfactor0

\f2\fs26 \cf0 photostudio-weave --json ./step1/garment_analysis.json --out ./step2 --seed 123\
\pard\pardeftab720\partightenfactor0

\f1\fs24 \cf3 \strokec3 \
\pard\pardeftab720\sa280\partightenfactor0

\f0\b\fs28 \cf0 \strokec2 Phase 3/6 \'97 Renderer (step3_renderer.py)\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Purpose
\f1\b0 : Generate 
\f0\b N
\f1\b0  candidates from the prompt.\

\f0\b Route A (Open-source)
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls12\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 SDXL base (diffusers), optional ControlNet (canny/lineart/depth), optional IP-Adapter (palette/label crop).\
\ls12\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Tunables: guidance, steps, seeds, control scales.\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Route B (Fast fallback)
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls13\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Gemini image generation (or mocked fallback during dev).\
\ls13\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Narrative prompt ingestion, multi-seed sampling, fast turnaround.\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Inputs
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls14\ilvl0
\f2\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 step2/prompt.txt
\f1\fs24 \
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Outputs
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls15\ilvl0
\f2\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 step3/candidates/candidate_*.png
\f1\fs24 , 
\f2\fs26 step3/candidates.meta.json
\f1\fs24 \
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 CLI
\f1\b0 \
\pard\pardeftab720\partightenfactor0

\f2\fs26 \cf0 photostudio-render --prompt ./step2/prompt.txt --out ./step3/candidates \\\
  --route routeA --candidates 4 --seed 42 --model stabilityai/stable-diffusion-xl-base-1.0\
# or fast path\
photostudio-render --prompt ./step2/prompt.txt --route routeB --candidates 3\
\pard\pardeftab720\partightenfactor0

\f1\fs24 \cf3 \strokec3 \
\pard\pardeftab720\sa280\partightenfactor0

\f0\b\fs28 \cf0 \strokec2 Phase 4/6 \'97 Auto-QA + Correct + Select (step4_qa_corrector.py)\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Purpose
\f1\b0 : Score candidates, apply surgical corrections, select the best.\

\f0\b Checks
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls16\ilvl0
\f0\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Color
\f1\b0 : \uc0\u916 E2000 mean + p95 vs primary hex (LAB space).\
\ls16\ilvl0
\f0\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Hollow
\f1\b0 : luminance/contrast heuristics for neckline/sleeves (proxy score).\
\ls16\ilvl0
\f0\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Sharpness
\f1\b0 : Laplacian variance.\
\ls16\ilvl0
\f0\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Background
\f1\b0 : normalized to white; zero shadows.\
\ls16\ilvl0
\f0\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Composite score
\f1\b0 : color(45%) + hollow(35%) + sharpness(20%).\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Auto-corrections
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls17\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 LAB bias toward primary hex (capped), background normalization, final recenter/resize.\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Outputs
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls18\ilvl0
\f2\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 step4/final.png
\f1\fs24  (2048\'d72048)\
\ls18\ilvl0
\f2\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 step4/qa_report.json
\f1\fs24  (all candidates, metrics, winner)\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 CLI
\f1\b0 \
\pard\pardeftab720\partightenfactor0

\f2\fs26 \cf0 photostudio-qa --candidates-dir ./step3/candidates \\\
  --analysis-json ./step1/garment_analysis.json --mask ./step1/mask.png \\\
  --out ./step4 --deltae-gate 2.0\
\pard\pardeftab720\partightenfactor0

\f1\fs24 \cf3 \strokec3 \
\pard\pardeftab720\sa280\partightenfactor0

\f0\b\fs28 \cf0 \strokec2 Phase 5/6 \'97 Package & Publish (delivery_engine.py)\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Purpose
\f1\b0 : Produce master + web variants, embed metadata, upload to CDN, emit manifest.\

\f0\b Features
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls19\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Content-addressable naming (SHA256), semantic versioning.\
\ls19\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 PNG master; WebP (2048/1024/512), optional AVIF, thumb (384).\
\ls19\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 sRGB ICC embedding, immutable cache headers.\
\ls19\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 S3 upload (optional), delivery manifest with checksums & metadata.\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Outputs
\f1\b0 \
\pard\pardeftab720\partightenfactor0

\f2\fs26 \cf0 /step5/\
  master/ SKU_variant_vX_<hash>.png\
  web/    *.webp, *.avif\
  thumbs/ *.webp\
  manifests/delivery_manifest.json\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b\fs24 \cf0 CLI
\f1\b0 \
\pard\pardeftab720\partightenfactor0

\f2\fs26 \cf0 photostudio-deliver --final ./step4/final.png --qa ./step4/qa_report.json \\\
  --json ./step1/garment_analysis.json --sku TSHIRT-001 --variant navy \\\
  --out ./step5 [--s3-bucket BUCKET --s3-prefix products/ --emit-avif]\
\pard\pardeftab720\partightenfactor0

\f1\fs24 \cf3 \strokec3 \
\pard\pardeftab720\sa280\partightenfactor0

\f0\b\fs28 \cf0 \strokec2 Phase 6/6 \'97 Feedback & Auto-Tuning (feedback_engine.py)\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Purpose
\f1\b0 : Persist telemetry, compute health, alert, and propose auto-tunes.\

\f0\b Data
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls20\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Run id, SKU, variant, route, template id, QA metrics, \uc0\u916 E, pass/fail, latency.\
\ls20\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 SQLite (dev) / Postgres (prod).\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Logic
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls21\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Composite health score; trend analysis; rules (YAML) to adjust seeds/guidance/route choice.\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Outputs
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls22\ilvl0
\f2\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 step6/feedback.db
\f1\fs24  (or Postgres)\
\ls22\ilvl0
\f2\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 step6/summary.json
\f1\fs24  (optional), alerts (Slack/email in prod)\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 CLI
\f1\b0 \
\pard\pardeftab720\partightenfactor0

\f2\fs26 \cf0 photostudio-feedback --run-id run_001 --sku TSHIRT-001 --variant navy --route routeB \\\
  --template-id photostudio_ghost_mannequin_v2 \\\
  --qa ./step4/qa_report.json --manifest ./step5/manifests/delivery_manifest.json \\\
  --processing-time 2.7 --db ./step6/feedback.db --out ./step6\
\pard\pardeftab720\partightenfactor0

\f1\fs24 \cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f0\b\fs36 \cf0 \strokec2 4) Module/Function Reference\
\pard\pardeftab720\partightenfactor0

\f2\b0\fs26 \cf0 classDiagram\
  class Step1Preprocess\{\
    +cli()\
    -_assess_image_quality()\
    -_segment_garment()\
    -_analyze_fabric()\
    -_extract_colors()\
    -_detect_pattern()\
    -_compile_output()\
  \}\
  class Step2PromptWeaver\{\
    +cli()\
    -_build_prompt()\
  \}\
  class Step3Renderer\{\
    +cli()\
    -_routeA_generate()\
    -_routeB_generate()\
  \}\
  class Step4QA\{\
    +cli()\
    -_delta_e2000_mean()\
    -_estimate_hollow_quality()\
    -_correct_color_toward_hex()\
    -_normalize_background()\
    -_sharpness_lapvar()\
  \}\
  class Step5Delivery\{\
    +cli()\
    ... (hashing, ICC, encode, upload)\
  \}\
  class Step6Feedback\{\
    +cli()\
    ... (upsert, scoring, rules)\
  \}\
\pard\pardeftab720\partightenfactor0

\f1\fs24 \cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f0\b\fs36 \cf0 \strokec2 5) Data Contracts (Schemas)\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf0 5.1 
\f3\fs30\fsmilli15210 garment_analysis.json
\f0\fs28  (Step 1 \uc0\u8594  2)\
\pard\pardeftab720\partightenfactor0

\f2\b0\fs26 \cf0 \{\
  "processing_metadata": \{\
    "session_id": "string", "pipeline_version": "1.0.2",\
    "timestamp": "iso", "processing_stages_completed": 4\
  \},\
  "input_validation": \{\
    "image_quality_score": 0.0,\
    "quality_issues": ["string"],\
    "preprocessing_suitable": true\
  \},\
  "segmentation_results": \{\
    "confidence_score": 0.0,\
    "boundary_irregularity": 0.0,\
    "background_separation": "clean|partial|complex",\
    "edge_quality": 0.0,\
    "mask_coverage": 0.0,\
    "contour_complexity": 0\
  \},\
  "fabric_analysis": \{ "...": "see code" \},\
  "color_extraction": \{\
    "primary_color": \{ "hex_value":"#112233", "color_name":"navy", "rgb_values":[17,34,51] \},\
    "secondary_colors": [\{ "hex_value":"#...", "percentage": 12.3 \}],\
    "pattern_analysis": \{ "pattern_type":"solid|geometric|...", "pattern_complexity": 0.12 \}\
  \},\
  "garment_categorization": \{ "primary_classification": \{ "category":"tops", "specific_type":"t-shirt" \}, "style_attributes": \{ "fit_type":"regular", "neckline":"crew", "sleeves":"short" \} \},\
  "brand_information": \{ "brand_visible": false, "brand_name": "unknown", "label_text": "" \}\
\}\
\pard\pardeftab720\sa280\partightenfactor0

\f0\b\fs28 \cf0 5.2 
\f3\fs30\fsmilli15210 prompt.meta.json
\f0\fs28  (Step 2 \uc0\u8594  3)\
\pard\pardeftab720\partightenfactor0

\f2\b0\fs26 \cf0 \{\
  "controls": \{ "temperature": 0.0, "top_p": 0.15, "seed": 123, "verification_level": "high" \},\
  "notes": \{\
    "template_id": "photostudio_ghost_mannequin_v2",\
    "inheritance_chain": ["base_product_photography","ghost_mannequin_specific"],\
    "category": "tops", "specific_type": "t-shirt", "primary_hex": "#112233"\
  \}\
\}\
\pard\pardeftab720\sa280\partightenfactor0

\f0\b\fs28 \cf0 5.3 
\f3\fs30\fsmilli15210 qa_report.json
\f0\fs28  (Step 4 \uc0\u8594  5/6)\
\pard\pardeftab720\partightenfactor0

\f2\b0\fs26 \cf0 \{\
  "primary_hex": "#112233",\
  "candidates": [\
    \{\
      "candidate": "path",\
      "corrected": "path",\
      "metrics": \{\
        "mean_delta_e": 1.7,\
        "p95_delta_e": 3.4,\
        "hollow_quality": 0.81,\
        "sharpness": 142.3,\
        "composite_score": 0.89\
      \}\
    \}\
  ],\
  "best_index": 2,\
  "final_path": "step4/final.png",\
  "summary": \{ "mean_best_score": 0.89, "pass_color_gate": true \}\
\}\
\pard\pardeftab720\sa280\partightenfactor0

\f0\b\fs28 \cf0 5.4 
\f3\fs30\fsmilli15210 delivery_manifest.json
\f0\fs28  (Step 5 \uc0\u8594  6 / consumers)\
\pard\pardeftab720\partightenfactor0

\f2\b0\fs26 \cf0 \{\
  "sku": "TSHIRT-001",\
  "variant": "navy",\
  "version": "v2",\
  "assets": \{\
    "master": \{ "path":".../master/TSHIRT-001_navy_v2_<hash>.png", "sha256":"...", "icc":"sRGB" \},\
    "web": [\
      \{"path":".../web/TSHIRT-001_navy_2048.webp","sha256":"...", "w":2048,"h":2048\},\
      \{"path":".../web/TSHIRT-001_navy_1024.webp","sha256":"...", "w":1024,"h":1024\}\
    ],\
    "thumb": \{ "path":".../thumbs/TSHIRT-001_navy_384.webp","w":384,"h":384 \}\
  \},\
  "source": \{ "qa_report":"step4/qa_report.json", "analysis":"step1/garment_analysis.json" \},\
  "cdn": \{ "bucket":"cdn-photostudio", "prefix":"products/TSHIRT-001/navy/" \},\
  "created_at": "iso"\
\}\
\pard\pardeftab720\partightenfactor0

\f1\fs24 \cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f0\b\fs36 \cf0 \strokec2 6) Operational Requirements\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 SLOs
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls23\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 p95 \uc0\u916 E2000 \u8804  4.0; mean \u8804  2.0\
\ls23\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Pass-rate (QA) \uc0\u8805  85%\
\ls23\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 p95 end-to-end \uc0\u8804  12s; p50 \u8804  8s (routeB), \u8804  15s (routeA)\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Error handling
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls24\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Each phase writes errors to 
\f2\fs26 \{phase\}/errors.log
\f1\fs24  and returns non-zero exit code on fatal conditions.\
\ls24\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Partial artifacts still written for debuggability.\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Security
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls25\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Secrets via env (API keys, S3 creds, DB URLs).\
\ls25\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 No PII in manifests; only SKU/variant and technical metadata.\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Observability
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls26\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Structured logs (JSON lines optional), per-step timing, image dims, seed/route, scores.\
\ls26\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Step 6 stores summary rows for dashboards/alerts.\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f0\b\fs36 \cf0 \strokec2 7) Risks & Mitigations\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls27\ilvl0
\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Segmentation failure
\f1\b0  \uc0\u8594  Fallback mask heuristics; warn & continue with low confidence.\
\ls27\ilvl0
\f0\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Color drift in render
\f1\b0  \uc0\u8594  Step 4 surgical LAB bias + \u916 E gates.\
\ls27\ilvl0
\f0\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Brand label loss
\f1\b0  (future) \uc0\u8594  Add dual-OCR & label bbox locks (IP-Adapter ref crop).\
\ls27\ilvl0
\f0\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Latency spikes
\f1\b0  \uc0\u8594  Route B fallback; batch seeds; TensorRT/xFormers in Route A.\
\ls27\ilvl0
\f0\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Model updates
\f1\b0  \uc0\u8594  Version model IDs and prompt templates; track in Step 6.\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f0\b\fs36 \cf0 \strokec2 8) Rollout Plan\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls28\ilvl0
\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Week 1
\f1\b0 : Steps 1\'963 smoke tests; style kit tuning; small SKU set.\
\ls28\ilvl0
\f0\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Week 2
\f1\b0 : Step 4 QA thresholds; start Step 5 upload to a staging S3/CDN.\
\ls28\ilvl0
\f0\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Week 3
\f1\b0 : Step 6 telemetry with SQLite \uc0\u8594  Postgres; dashboards; rules.\
\ls28\ilvl0
\f0\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Week 4
\f1\b0 : Production launch; watch KPIs; iterate thresholds & templates.\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f0\b\fs36 \cf0 \strokec2 9) \'93Claude-ready\'94 Blocks (copy/paste)\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf0 9.1 Ask Claude to review the architecture\
\pard\pardeftab720\partightenfactor0

\f2\b0\fs26 \cf0 You are a principal engineer. Review this 6-phase architecture for reliability and drift control.\
\
Goals:\
- Maintain \uc0\u916 E2000 mean \u8804  2.0 and pass-rate \u8805  85%.\
- Keep consistency \uc0\u8805  90\'9695% while minimizing latency.\
\
Here is the pipeline summary (paste PRD sections 2\'965 here).\
Suggest concrete improvements and risks we missed.\
\pard\pardeftab720\sa280\partightenfactor0

\f0\b\fs28 \cf0 9.2 Ask Claude for prompt A/B variants (Step 2)\
\pard\pardeftab720\partightenfactor0

\f2\b0\fs26 \cf0 Generate 3 prompt variants that keep sections & constraints identical but vary phrasing to minimize model bias drift.\
Inputs:\
- Non-negotiable facts: <paste from JSON-paraphrased bullets>\
- Style guide: <paste>\
- Garment rules: <paste>\
Return ONLY the 3 prompts, no commentary.\
\pard\pardeftab720\sa280\partightenfactor0

\f0\b\fs28 \cf0 9.3 Ask Claude for auto-tuning proposals (Step 6)\
\pard\pardeftab720\partightenfactor0

\f2\b0\fs26 \cf0 Given these last 500 runs (JSON rows), propose rule updates:\
- Increase/Decrease guidance, steps, or switch route based on \uc0\u916 E and pass-rate drift.\
- Suggest seed rotation strategy.\
Return a YAML rules diff with confidence per change.\
\pard\pardeftab720\partightenfactor0

\f1\fs24 \cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f0\b\fs36 \cf0 \strokec2 10) Quick Start (End-to-End)\
\pard\pardeftab720\partightenfactor0

\f2\b0\fs26 \cf0 # 1\
photostudio-preprocess --image ./inputs/tshirt.jpg --out ./step1\
# 2\
photostudio-weave --json ./step1/garment_analysis.json --out ./step2\
# 3\
photostudio-render --prompt ./step2/prompt.txt --out ./step3/candidates --route routeB --candidates 3\
# 4\
photostudio-qa --candidates-dir ./step3/candidates --analysis-json ./step1/garment_analysis.json --mask ./step1/mask.png --out ./step4\
# 5\
photostudio-deliver --final ./step4/final.png --qa ./step4/qa_report.json --json ./step1/garment_analysis.json \\\
  --sku TSHIRT-001 --variant navy --out ./step5\
# 6\
photostudio-feedback --run-id run_001 --sku TSHIRT-001 --variant navy --route routeB \\\
  --template-id photostudio_ghost_mannequin_v2 --qa ./step4/qa_report.json \\\
  --manifest ./step5/manifests/delivery_manifest.json --processing-time 2.7 \\\
  --db ./step6/feedback.db --out ./step6\
\pard\pardeftab720\partightenfactor0

\f1\fs24 \cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f0\b\fs36 \cf0 \strokec2 11) Appendices\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Configs
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls29\ilvl0
\f2\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 configs/style_kit.yml
\f1\fs24  \'97 style guardrails and \uc0\u916 E tolerance\
\ls29\ilvl0
\f2\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 configs/tuner_rules.yml
\f1\fs24  \'97 Step 6 rules (route choice, seed rotation, guidance adjustments)\
\pard\pardeftab720\sa240\partightenfactor0

\f0\b \cf0 Environments
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls30\ilvl0
\f2\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 pip install .
\f1\fs24  with extras: 
\f2\fs26 [gen]
\f1\fs24  for diffusers, 
\f2\fs26 [s3]
\f1\fs24  for S3, 
\f2\fs26 [postgres]
\f1\fs24  for Postgres, 
\f2\fs26 [qa_ocr]
\f1\fs24  later for label OCR.\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa240\partightenfactor0
\cf0 \strokec2 if you want, i can also spin this into a single \'93master README\'94 for the repo with links to each script and example outputs.\
}